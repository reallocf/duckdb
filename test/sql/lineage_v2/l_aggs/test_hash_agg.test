# name: test/sql/lineage_v2/l_aggs/test_hash_agg.test
# description: Test Hash Aggregate Lineage
# group: [l_aggs]

# TODO: add null, multithreading, partitioned, etc

statement ok
PRAGMA explain_output = PHYSICAL_ONLY;


statement ok
CREATE TABLE t1(i VARCHAR(10), j INTEGER);

statement ok
INSERT INTO t1 VALUES ('Haneen', 2),  ('Omar', 2), ('Haneen', 4), ('Mohammed', 1), ('Omar', 1), ('Haneen', 3), ('Mohammed', 2), ('Omar', 1)

statement ok
PRAGMA trace_lineage = "ON";

# standalone limit
query II
select t1.i, avg(t1.j) from t1 GROUP BY t1.i
----
Haneen	3.000000
Omar	1.333333
Mohammed	1.500000

statement ok
PRAGMA trace_lineage = "OFF";

query III
SELECT * FROM queries_list;
----
0	PRAGMA trace_lineage = "ON";	0
1	select t1.i, avg(t1.j) from t1 GROUP BY t1.i	0


query III
select * from LINEAGE_1_SEQ_SCAN_0_0
----
0	0	-1	Haneen	2
1	1	-1	Omar	2
2	2	-1	Haneen	4
3	3	-1	Mohammed	1
4	4	-1	Omar	1
5	5	-1	Haneen	3
6	6	-1	Mohammed	2
7	7	-1	Omar	1

statement ok
select * from LINEAGE_1_HASH_GROUP_BY_2_0

statement ok
select * from LINEAGE_1_HASH_GROUP_BY_2_1

statement ok
select * from LINEAGE_1_HASH_GROUP_BY_2_2

# if x, then merge 0, 1, 2 during runtime and return the results
query III
select * from LINEAGE_1_HASH_GROUP_BY_2_X
----
0	0
1	1
2	0
3	2
4	1
5	0
6	2
7	1