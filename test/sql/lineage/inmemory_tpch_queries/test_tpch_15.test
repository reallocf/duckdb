# name: test/sql/lineage/inmemory_tpch_queries/test_tpch_15.test
# description: Test TPC-H Query 15 in-memory
# group: [inmemory_tpch_queries]

require tpch

statement ok
CALL dbgen(sf=0.01);

statement ok
PRAGMA trace_lineage = "ON";

statement ok
SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey

statement ok
PRAGMA trace_lineage = "OFF";

# TODO is this right? Seems pretty right... hard to tell due to so much volume

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'VALUE', '0')
----
[20, 40, 7771, 9952, 10903, 12472, 13499, 14203, 15560, 16513, 19101, 25233, 27039, 29183, 29534, 32503, 32928, 33013, 34384, 36564, 40603, 42862, 44694, 46107, 48013, 49124, 50241, 50488, 51050, 52242, 53103, 54726, 55999, 58538, 59905, 11610, 12409, 13323, 17621, 19617, 20160, 22721, 24624, 28935, 33289, 33820, 39586, 43666, 44440, 49360, 50469, 51188, 51369, 54226, 55542, 55545, 60161, 4007, 4696, 18532, 19172, 21997, 22982, 25500, 26617, 27468, 31165, 32667, 33441, 38780, 42613, 42648, 44072, 47253, 58390, 154, 1656, 10888, 12581, 18004, 18022, 20779, 26381, 31600, 31638, 32267, 36814, 41627, 42910, 44559, 46898, 46949, 48668, 51710, 52133, 54390, 58128, 58758, 7397, 10306, 12181, 12883, 13248, 15305, 19078, 19615, 19616, 21230, 28545, 29546, 30729, 32343, 33484, 35016, 37231, 37304, 39173, 45003, 46844, 47274, 49123, 50238, 50472, 50480, 54536, 54715, 58724, 2631, 5042, 12803, 13497, 17341, 18189, 20391, 25148, 28882, 32799, 34387, 35589, 36574, 42546, 44999, 46357, 47424, 52049, 53028, 53104, 54538, 57044, 59903, 7115, 9517, 12543, 16619, 16820, 17999, 18820, 22636, 22981, 25888, 28061, 30288, 32457, 32479, 34081, 35314, 38103, 40105, 40204, 42614, 44031, 45133, 45599, 51897, 357, 1775, 6790, 10570, 10935, 14637, 17860, 18509, 22271, 24510, 25131, 25403, 28544, 33972, 34588, 35604, 37904, 38011, 41614, 41704, 44554, 45570, 47927, 50912, 53301, 55988, 60164, 3013, 11663, 15446, 18001, 29818, 32243, 33443, 33742, 35017, 39585, 42911, 45002, 48723, 50545, 56486, 58759, 58817, 59678, 59721, 2633, 3366, 11242, 11664, 12435, 12436, 14128, 18510, 19611, 21239, 21508, 21790, 25449, 27833, 29819, 31583, 32902, 37137, 42470, 46987, 48890, 53646, 55387, 5, 2811, 4758, 9376, 10569, 18506, 18988, 20568, 20851, 20852, 24922, 26813, 32402, 32424, 35862, 49687, 53323, 58111, 2630, 6011, 7109, 9512, 10247, 14408, 17025, 24032, 25404, 28329, 29624, 32263, 39370, 42354, 45165, 45573, 46843, 49685, 51374, 55544, 59161, 9379, 9632, 9953, 10574, 11399, 11571, 11611, 18701, 22722, 23132, 23397, 26476, 27985, 32933, 33482, 37139, 37142, 45697, 47123, 51598, 51885, 52486, 58540, 286, 1191, 4827, 6447, 13090, 15914, 16615, 17810, 21833, 23472, 27016, 27262, 31581, 33776, 35903, 42337, 47268, 47399, 48350, 48614, 52047, 52246, 55663, 56273, 774, 12802, 12804, 15857, 17557, 23108, 27368, 27372, 27455, 27986, 32246, 32650, 39886, 41613, 42088, 44318, 47401, 50946, 51949, 51994, 52102, 58757, 3365, 6115, 11244, 12807, 15651, 15957, 19167, 20780, 22819, 24659, 27080, 27470, 31537, 31693, 35700, 37476, 44295, 48077, 49794, 56002, 57441, 58197, 58896, 3310, 3496, 5349, 8439, 8479, 10165, 14726, 18561, 20813, 20895, 22640, 29893, 32969, 38135, 39165, 44313, 45596, 47551, 49506, 52048, 53327, 56613, 56727, 58231, 60162, 20, 152, 6451, 10526, 11660, 12259, 14776, 20311, 21236, 23471, 24621, 32184, 35701, 37750, 47254, 47501, 50220, 53001, 53063, 57042, 1991, 2634, 3673, 6446, 10120, 10571, 12083, 17397, 19077, 21206, 21509, 21952, 22738, 26607, 26998, 27090, 27730, 36031, 37939, 39887, 42277, 44069, 45597, 51183, 52975, 54285, 57259, 862, 2635, 3038, 3041, 3307, 8415, 10309, 15639, 22458, 27367, 28542, 30170, 30934, 31296, 35584, 40726, 40899, 46989, 47444, 47947, 48045, 49019, 51128, 57636, 58886, 4601, 7558, 13184, 15561, 21506, 21811, 25498, 31057, 31139, 32247, 39855, 41219, 41706, 43285, 48530, 50102, 51996, 55590, 55891, 59586, 40, 7771, 9952, 10903, 12472, 13499, 14203, 15560, 16513, 19101, 25233, 27039, 29183, 29534, 32503, 32928, 33013, 34384, 36564, 40603, 42862, 44694, 46107, 48013, 49124, 50241, 50488, 51050, 52242, 53103, 54726, 55999, 58538, 59905, 1601, 10167, 10541, 10891, 12433, 14407, 19576, 21955, 21996, 22645, 25994, 27079, 30673, 32126, 32580, 32916, 33102, 39582, 40413, 45993, 51380, 51683, 52997, 58763, 4, 1605, 4695, 8086, 9317, 12998, 15760, 21780, 27527, 29625, 29940, 31585, 32927, 34203, 35059, 39023, 39587, 41307, 45572, 45670, 47148, 47256, 50855, 58109, 9575, 16821, 18407, 21768, 28507, 28880, 33735, 35451, 36717, 42955, 44700, 47400, 47502, 48515, 51622, 53142, 54280, 54485, 56145, 56162, 58602, 58894, 59274, 5938, 9552, 16984, 17218, 19165, 22002, 25101, 25127, 32844, 33871, 37232, 37936, 39888, 42218, 45698, 47460, 51606, 51888, 52520, 55541, 57144, 57262, 58892, 23, 4600, 13778, 20850, 23961, 24658, 26606, 27366, 32502, 32762, 35698, 35799, 37902, 39856, 42617, 48891, 50543, 52241, 53026, 1272, 1602, 6792, 7086, 8671, 12260, 12434, 18527, 20308, 20425, 20931, 21507, 22736, 25447, 25553, 27838, 28809, 31584, 32917, 41702, 46616, 48514, 50859, 56936, 1603, 2741, 3309, 3386, 5277, 6454, 6789, 11243, 19018, 19574, 19982, 22985, 27265, 45812, 47443, 47930, 50735, 52519, 52596, 57346, 57821, 58541, 1466, 11473, 12102, 12476, 17023, 18703, 21204, 25102, 26317, 27020, 30726, 32842, 36547, 39598, 40900, 48714, 57493, 58193, 4419, 7699, 14405, 14636, 15955, 19577, 28932, 32245, 37473, 38981, 46853, 51889, 53007, 55546, 55890, 55989, 56152, 58669, 58761, 59663, 38, 7556, 7922, 9097, 11047, 11292, 13711, 15444, 16818, 20877, 22817, 23396, 26595, 27083, 31696, 32581, 34253, 38102, 40315, 40735, 42221, 44202, 47255, 47270, 50767, 51124, 52481, 52594, 53887, 56096, 56410, 57984, 21, 3960, 5302, 6448, 8190, 12128, 12182, 15372, 20825, 21818, 32266, 42469, 42645, 43412, 44661, 45182, 47235, 47550, 49183, 50471, 51693, 51891, 52243, 53029, 57422, 58728, 58883, 4804, 8668, 10242, 18146, 25145, 25229, 27536, 30731, 32400, 32921, 40238, 40720, 41672, 42252, 42274, 42353, 47257, 47863, 47929, 48848, 50101, 50222, 51081, 52363, 54334, 55601, 56107, 56272, 57367, 3088, 15976, 22447, 27979, 28058, 32455, 35590, 35840, 37492, 41698, 48076, 49684, 51189, 52488, 426, 427, 1274, 9375, 20554, 22723, 25096, 25856, 26321, 27840, 28806, 33356, 36392, 38903, 39823, 42089, 42352, 42863, 45127, 49733, 50470, 51481, 51624, 54579, 55892, 60158, 12422, 17219, 20557, 22068, 22143, 31694, 31738, 32653, 39174, 43801, 52320, 52579, 52979, 53805, 55749, 56058, 56274, 57246, 57356, 58132, 58580, 43, 4003, 4809, 16817, 19076, 20893, 21954, 22396, 23192, 26281, 30499, 32333, 32932, 41645, 41924, 44316, 45994, 48722, 51372, 52515, 53062, 53267, 58110, 2, 3089, 7044, 7400, 7702, 9273, 9955, 12291, 24534, 27115, 30888, 32839, 33950, 36549, 38139, 41923, 42908, 44277, 45193, 47426, 47462, 48337, 49899, 60166, 7114, 12542, 14043, 14910, 21998, 22139, 23134, 23135, 24924, 26367, 30745, 31720, 32248, 32505, 33442, 33969, 37483, 41845, 46474, 48075, 51082, 51367, 53641, 57248, 22, 155, 6715, 9322, 10885, 11400, 12539, 14728, 17202, 18406, 22147, 22186, 22647, 29877, 32186, 32582, 37138, 37474, 41926, 42953, 44861, 45574, 57986, 220, 1727, 4659, 11398, 13709, 15854, 16986, 18405, 18559, 20162, 26382, 34820, 36575, 37752, 39452, 39660, 40727, 50223, 50490, 52746, 56001, 6457, 8450, 15382, 19530, 19637, 21820, 29184, 31548, 32920, 35753, 36544, 42273, 47548, 48423, 48721, 50815, 52240, 52977, 53141, 55735, 58760, 59109, 59714, 358, 861, 4421, 6445, 19265, 22399, 22639, 29389, 30890, 32669, 35900, 37863, 39100, 39854, 40104, 46005, 49686, 50302, 54582, 56189, 56609, 57012, 57496, 58890, 2976, 6179, 10573, 12261, 13366, 14948, 15856, 17805, 18529, 26684, 30505, 33737, 39083, 44071, 47505, 49126, 50947, 4657, 4746, 6504, 10904, 13324, 14125, 17559, 22039, 23395, 25406, 26475, 30126, 30889, 31717, 32090, 34083, 36579, 37901, 38349, 40147, 46895, 48046, 49364, 51951, 57013, 59725, 2971, 7043, 9380, 11403, 18254, 18369, 20984, 22187, 22733, 22784, 25143, 25144, 28505, 29201, 33740, 36353, 36828, 37482, 37494, 39334, 39450, 39851, 41287, 42429, 42861, 45128, 48120, 48849, 52104, 58671, 59718, 1994, 10773, 11572, 12585, 18408, 25501, 26034, 26366, 30256, 30501, 31059, 32264, 32335, 34757, 39086, 42638, 46947, 52478, 52748, 53265, 58112, 59369, 59497, 3222, 7401, 17742, 20853, 21824, 25502, 26285, 27537, 33288, 37141, 51048, 52480, 428, 3221, 3538, 3672, 6713, 6872, 10308, 10771, 11579, 12999, 17464, 19075, 23773, 25097, 27370, 27907, 34086, 35752, 37493, 38101, 42338, 42808, 44074, 48074, 53065, 53797, 54229, 57145, 58129, 59585, 1657, 2974, 5939, 9256, 11879, 12100, 15715, 15915, 17811, 18188, 18355, 25170, 25471, 26365, 29185, 30172, 32091, 38012, 38757, 40897, 41697, 47549, 50131, 53140, 54249, 56269, 58537, 59106, 776, 8449, 10993, 12081, 13870, 16987, 17338, 18023, 18025, 27116, 28248, 31597, 33739, 34821, 36716, 37140, 38736, 49017, 49502, 50857, 53614, 56693, 59726, 1970, 5300, 6008, 9321, 11662, 12014, 12406, 14200, 15291, 27835, 30190, 31598, 36719, 38484, 46847, 48887, 49688, 51997, 55389, 55986, 55998, 58756, 58889, 59496, 8507, 9258, 10572, 11569, 15054, 16292, 32813, 33100, 36208, 39268, 43701, 49359, 49898, 49974, 51623, 57014, 58107, 59347, 24, 13092, 13182, 14634, 17201, 19533, 24657, 36822, 39249, 44516, 47276, 48611, 48900, 54282, 54583, 55588, 56694, 58131, 1271, 3235, 4527, 4810, 5251, 9951, 10523, 10994, 13696, 14328, 32878, 34383, 39668, 44073, 45568, 47237, 48043, 50130, 52750, 58428, 2040, 2979, 3563, 5043, 10292, 11580, 14635, 25322, 27469, 31661, 32403, 33292, 38905, 38921, 41289, 42615, 45569, 47950, 49949, 50836, 52883, 53011, 56192, 57245, 58818, 1573, 1942, 5044, 5648, 5649, 6114, 10244, 10751, 14112, 14406, 17203, 18304, 20148, 25103, 25854, 26322, 26343, 26623, 30124, 39085, 44663, 50635, 50768, 52005, 52101, 52244, 52335, 52978, 58838, 2550, 6006, 7112, 12475, 12968, 15331, 18409, 20555, 20876, 22140, 23075, 27081, 29083, 29894, 32454, 37480, 38993, 44382, 48047, 49125, 52485, 52514, 53008, 54577, 54712, 56154, 57927, 59716, 2187, 5303, 10311, 13777, 15855, 22638, 23470, 25142, 26346, 26348, 26592, 29923, 30169, 30727, 31294, 32810, 34287, 35454, 42545, 46698, 46854, 56465, 57929, 58823, 2951, 4350, 6966, 9323, 9798, 15275, 15959, 20214, 20783, 21234, 22300, 25405, 33778, 33779, 34290, 39368, 40103, 40728, 41147, 44955, 47503, 52002, 55665, 55703, 12082, 13698, 16511, 18540, 20930, 23478, 25128, 25129, 29186, 29821, 30291, 33347, 35252, 36289, 41591, 43410, 46617, 47458, 50885, 52003, 54227, 54486, 59501, 39, 4806, 7701, 11512, 15180, 22301, 22467, 22646, 26810, 29892, 38807, 44436, 47236, 47954, 49732, 51381, 51695, 56108, 56157, 2972, 2997, 7975, 13776, 22067, 22983, 26319, 27002, 31659, 32089, 34756, 35103, 37000, 38759, 39250, 39451, 41696, 45216, 46618, 49363, 51373, 56191, 57015, 58233, 59370, 3566, 12180, 12806, 17026, 20811, 23473, 30017, 30732, 32127, 33358, 33837, 51608, 56106, 58844, 856, 1611, 7049, 11609, 18356, 25146, 25231, 25855, 27899, 32187, 32244, 32499, 35587, 37495, 39453, 42348, 42817, 46900, 47553, 51625, 52518, 58755, 59588, 4102, 14723, 21782, 23962, 26283, 26318, 27369, 36546, 39889, 46003, 46955, 49897, 50881, 52046, 53107, 53695, 55589, 2336, 3494, 6181, 9324, 10119, 15956, 16616, 18643, 22246, 22780, 25445, 27263, 34080, 35102, 36718, 41148, 44297, 50103, 54724, 57632, 58230, 58579, 59921, 9954, 11057, 11582, 12423, 15379, 15917, 19613, 20310, 20987, 27114, 30028, 31718, 35938, 42356, 45014, 58836, 242, 1240, 2740, 4832, 5936, 6791, 9631, 12104, 16816, 17340, 20424, 26620, 28792, 31595, 32506, 34755, 41149, 41615, 51607, 51694, 52516, 53808, 54033, 56271, 3182, 4422, 4824, 10769, 23079, 23479, 25095, 25228, 27001, 29489, 32931, 33869, 44032, 56159, 57017, 57495, 3237, 10246, 12541, 16985, 17986, 19571, 19612, 23398, 24687, 28794, 29875, 33438, 36212, 37299, 42951, 44696, 48892, 51993, 52322, 2993, 7111, 10241, 11245, 18143, 20777, 20782, 20894, 20985, 22270, 22984, 29954, 30255, 30728, 31410, 32418, 32501, 33439, 37660, 37862, 37900, 51992, 54580, 56097, 58897, 4656, 4807, 11500, 11581, 22038, 22042, 22648, 22735, 42355, 47482, 48348, 51052, 52880, 53300, 53694, 3039, 7110, 12592, 13430, 22466, 26604, 32583, 39584, 39850, 44294, 45001, 46899, 47925, 48335, 48425, 53268, 54386, 56456, 57366, 59371, 2343, 3278, 4655, 7238, 10014, 12879, 13180, 13432, 16589, 16892, 22296, 22627, 24923, 26282, 27082, 27523, 29087, 33014, 33241, 39284, 41670, 42428, 42810, 44414, 45521, 47504, 49361, 51125, 54578, 55600, 56571, 56574, 58753, 1990, 4602, 6455, 10995, 12608, 13091, 14638, 15977, 17484, 18144, 18850, 19169, 21822, 22184, 23109, 25099, 26603, 31741, 36545, 37751, 38364, 40776, 40898, 47258, 50544, 52576, 52980, 56000, 56148, 57260, 3565, 6186, 6514, 17345, 18822, 19614, 23393, 26593, 26605, 27538, 29623, 31582, 32224, 32268, 32458, 32654, 33822, 35865, 38758, 39842, 46620, 46690, 47926, 54725, 56161, 56692, 57368, 59348, 288, 2680, 3236, 3277, 3407, 7974, 12084, 19262, 23774, 26284, 28879, 29953, 35749, 41676, 42646, 44070, 45680, 51482, 54319, 55947, 4658, 4830, 23482, 27524, 28546, 34291, 35808, 39098, 39329, 41167, 41665, 44664, 46004, 49184, 49795, 54673, 55543, 57494, 2973, 4005, 7085, 7236, 18002, 19017, 23133, 25542, 27264, 32093, 32840, 32879, 34082, 36804, 42222, 47120, 51047, 51684, 59349, 60163, 13, 4825, 8219, 9255, 12272, 19014, 21770, 33952, 33953, 35011, 41156, 42275, 44514, 47102, 47119, 48846, 50860, 52517, 57928, 59500, 59920, 2037, 2320, 5041, 7977, 15293, 18145, 19016, 23166, 30030, 32219, 32500, 34201, 37914, 39325, 39448, 42256, 42276, 44484, 48886, 50634, 50944, 51127, 52365, 52477, 53064, 53106, 55256, 56190, 58819, 59373, 355, 3338, 6712, 9316, 15445, 17027, 18526, 19490, 25857, 26594, 36714, 41705, 42138, 42139, 42350, 44199, 46845, 48122, 58762, 59377, 151, 1241, 1650, 3498, 3602, 6005, 6180, 7102, 11568, 15960, 18000, 21817, 22141, 27266, 29491, 32763, 39371, 41841, 42219, 45682, 45696, 47100, 47552, 49362, 53067, 54483, 57041, 59919, 9377, 12290, 20897, 21953, 25147, 25543, 27873, 31166, 31660, 32973, 33290, 35699, 38485, 41288, 43617, 52998, 56611, 59715, 59722, 59922, 858, 1993, 7107, 12122, 13706, 19266, 21781, 25858, 27832, 30743, 31697, 33099, 39449, 40361, 44439, 47442, 51049, 51126, 56268, 57820, 58130, 59910, 541, 1939, 3234, 3539, 5942, 12408, 13322, 15089, 20558, 20879, 25319, 31536, 33777, 38738, 42278, 42349, 42909, 46954, 48872, 51079, 52045, 52050, 52749, 54484, 59719, 480, 974, 4106, 4747, 6453, 9318, 9325, 10770, 15295, 16573, 20878, 21232, 21532, 21825, 22001, 26618, 27348, 32648, 50838, 54247, 58895, 777, 1604, 4534, 4757, 4955, 15276, 22734, 27729, 27990, 37490, 40414, 41595, 44567, 46475, 49922, 50943, 52000, 55257, 56570, 59923, 3405, 4101, 6185, 6868, 10568, 14202, 22000, 23480, 26383, 28328, 28796, 32651, 34381, 36354, 38137, 38739, 41673, 42616, 47953, 50883, 53807, 56149, 56225, 56482, 57635, 2970, 7048, 14129, 15717, 18024, 18562, 24622, 28808, 32125, 32843, 38104, 44200, 44293, 45131, 45594, 47946, 50478, 51682, 52778, 52854, 53027, 54228, 56003, 56728, 58204, 59104, 389, 3033, 3090, 7700, 9797, 10310, 14911, 17911, 18920, 19100, 20776, 21821, 22657, 26461, 26685, 30166, 33956, 34127, 38737, 41150, 44662, 46108, 46953, 51371, 51696, 51709, 55213, 57497, 0, 19, 11607, 12418, 13149, 16272, 16572, 30254, 31599, 32092, 35585, 38105, 42314, 46284, 54723, 56186, 58194, 59160, 4104, 4826, 5134, 17342, 19013, 21999, 24660, 29084, 30026, 30926, 36543, 38138, 39337, 41308, 44278, 44517, 47936, 51370, 51890, 52487, 53303, 56059, 59904, 287, 5045, 5940, 8509, 10314, 11401, 20809, 25499, 31596, 32334, 35809, 39852, 44201, 44435, 46437, 46619, 47483, 55734, 59587, 10164, 24371, 25130, 25448, 26622, 28547, 30127, 32699, 33821, 33867, 36997, 39599, 46950, 47403, 48121, 49689, 54385, 59909, 153, 540, 775, 2975, 3219, 7399, 11608, 17503, 18919, 19529, 20781, 23078, 23110, 32124, 33483, 34248, 34586, 37243, 45595, 45681, 47461, 49948, 51379, 52578, 53000, 59499, 2039, 2042, 9327, 10291, 11606, 12593, 13431, 14130, 14724, 20390, 20896, 25321, 29970, 30171, 31164, 32331, 32974, 33971, 35586, 48847, 52595, 56188, 59723, 44, 495, 2994, 5282, 5941, 9067, 15053, 15375, 17220, 21836, 27467, 28805, 29878, 29924, 30886, 35588, 38504, 41612, 49976, 50098, 50487, 52976, 54540, 54668, 58234, 112, 5937, 15716, 16617, 19033, 25126, 27906, 29086, 32398, 32877, 36998, 37491, 39367, 52879, 55212, 56573, 56610, 56612, 57261, 58581]

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'COUNT', '0')
----
2319

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'LIN', '0')
----
2319

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'PERM', '0')
----
5784

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'PROV', '0')
----
2319
