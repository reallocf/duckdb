# name: test/sql/lineage/inmemory_tpch_queries/test_tpch_15.test
# description: Test TPC-H Query 15 in-memory
# group: [inmemory_tpch_queries]

require tpch

statement ok
CALL dbgen(sf=0.01);

statement ok
PRAGMA trace_lineage = "ON";

statement ok
SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey

statement ok
PRAGMA trace_lineage = "OFF";

# TODO is this right? Seems pretty right... hard to tell due to so much volume

query I
PRAGMA lineage_query("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'VALUE', 0)
----
[20, 0, 2, 4, 5, 13, 19, 20, 21, 22, 23, 24, 38, 39, 40, 43, 44, 112, 151, 152, 153, 154, 155, 220, 242, 286, 287, 288, 355, 357, 358, 389, 426, 427, 428, 480, 495, 540, 541, 774, 775, 776, 777, 856, 858, 861, 862, 974, 1191, 1240, 1241, 1271, 1272, 1274, 1466, 1573, 1601, 1602, 1603, 1604, 1605, 1611, 1650, 1656, 1657, 1727, 1775, 1939, 1942, 1970, 1990, 1991, 1993, 1994, 2037, 2039, 2040, 2042, 2187, 2320, 2336, 2343, 2550, 2630, 2631, 2633, 2634, 2635, 2680, 2740, 2741, 2811, 2951, 2970, 2971, 2972, 2973, 2974, 2975, 2976, 2979, 2993, 2994, 2997, 3013, 3033, 3038, 3039, 3041, 3088, 3089, 3090, 3182, 3219, 3221, 3222, 3234, 3235, 3236, 3237, 3277, 3278, 3307, 3309, 3310, 3338, 3365, 3366, 3386, 3405, 3407, 3494, 3496, 3498, 3538, 3539, 3563, 3565, 3566, 3602, 3672, 3673, 3960, 4003, 4005, 4007, 4101, 4102, 4104, 4106, 4350, 4419, 4421, 4422, 4527, 4534, 4600, 4601, 4602, 4655, 4656, 4657, 4658, 4659, 4695, 4696, 4746, 4747, 4757, 4758, 4804, 4806, 4807, 4809, 4810, 4824, 4825, 4826, 4827, 4830, 4832, 4955, 5041, 5042, 5043, 5044, 5045, 5134, 5251, 5277, 5282, 5300, 5302, 5303, 5349, 5648, 5649, 5936, 5937, 5938, 5939, 5940, 5941, 5942, 6005, 6006, 6008, 6011, 6114, 6115, 6179, 6180, 6181, 6185, 6186, 6445, 6446, 6447, 6448, 6451, 6453, 6454, 6455, 6457, 6504, 6514, 6712, 6713, 6715, 6789, 6790, 6791, 6792, 6868, 6872, 6966, 7043, 7044, 7048, 7049, 7085, 7086, 7102, 7107, 7109, 7110, 7111, 7112, 7114, 7115, 7236, 7238, 7397, 7399, 7400, 7401, 7556, 7558, 7699, 7700, 7701, 7702, 7771, 7922, 7974, 7975, 7977, 8086, 8190, 8219, 8415, 8439, 8449, 8450, 8479, 8507, 8509, 8668, 8671, 9067, 9097, 9255, 9256, 9258, 9273, 9316, 9317, 9318, 9321, 9322, 9323, 9324, 9325, 9327, 9375, 9376, 9377, 9379, 9380, 9512, 9517, 9552, 9575, 9631, 9632, 9797, 9798, 9951, 9952, 9953, 9954, 9955, 10014, 10119, 10120, 10164, 10165, 10167, 10241, 10242, 10244, 10246, 10247, 10291, 10292, 10306, 10308, 10309, 10310, 10311, 10314, 10523, 10526, 10541, 10568, 10569, 10570, 10571, 10572, 10573, 10574, 10751, 10769, 10770, 10771, 10773, 10885, 10888, 10891, 10903, 10904, 10935, 10993, 10994, 10995, 11047, 11057, 11242, 11243, 11244, 11245, 11292, 11398, 11399, 11400, 11401, 11403, 11473, 11500, 11512, 11568, 11569, 11571, 11572, 11579, 11580, 11581, 11582, 11606, 11607, 11608, 11609, 11610, 11611, 11660, 11662, 11663, 11664, 11879, 12014, 12081, 12082, 12083, 12084, 12100, 12102, 12104, 12122, 12128, 12180, 12181, 12182, 12259, 12260, 12261, 12272, 12290, 12291, 12406, 12408, 12409, 12418, 12422, 12423, 12433, 12434, 12435, 12436, 12472, 12475, 12476, 12539, 12541, 12542, 12543, 12581, 12585, 12592, 12593, 12608, 12802, 12803, 12804, 12806, 12807, 12879, 12883, 12968, 12998, 12999, 13090, 13091, 13092, 13149, 13180, 13182, 13184, 13248, 13322, 13323, 13324, 13366, 13430, 13431, 13432, 13497, 13499, 13696, 13698, 13706, 13709, 13711, 13776, 13777, 13778, 13870, 14043, 14112, 14125, 14128, 14129, 14130, 14200, 14202, 14203, 14328, 14405, 14406, 14407, 14408, 14634, 14635, 14636, 14637, 14638, 14723, 14724, 14726, 14728, 14776, 14910, 14911, 14948, 15053, 15054, 15089, 15180, 15275, 15276, 15291, 15293, 15295, 15305, 15331, 15372, 15375, 15379, 15382, 15444, 15445, 15446, 15560, 15561, 15639, 15651, 15715, 15716, 15717, 15760, 15854, 15855, 15856, 15857, 15914, 15915, 15917, 15955, 15956, 15957, 15959, 15960, 15976, 15977, 16272, 16292, 16511, 16513, 16572, 16573, 16589, 16615, 16616, 16617, 16619, 16816, 16817, 16818, 16820, 16821, 16892, 16984, 16985, 16986, 16987, 17023, 17025, 17026, 17027, 17201, 17202, 17203, 17218, 17219, 17220, 17338, 17340, 17341, 17342, 17345, 17397, 17464, 17484, 17503, 17557, 17559, 17621, 17742, 17805, 17810, 17811, 17860, 17911, 17986, 17999, 18000, 18001, 18002, 18004, 18022, 18023, 18024, 18025, 18143, 18144, 18145, 18146, 18188, 18189, 18254, 18304, 18355, 18356, 18369, 18405, 18406, 18407, 18408, 18409, 18506, 18509, 18510, 18526, 18527, 18529, 18532, 18540, 18559, 18561, 18562, 18643, 18701, 18703, 18820, 18822, 18850, 18919, 18920, 18988, 19013, 19014, 19016, 19017, 19018, 19033, 19075, 19076, 19077, 19078, 19100, 19101, 19165, 19167, 19169, 19172, 19262, 19265, 19266, 19490, 19529, 19530, 19533, 19571, 19574, 19576, 19577, 19611, 19612, 19613, 19614, 19615, 19616, 19617, 19637, 19982, 20148, 20160, 20162, 20214, 20308, 20310, 20311, 20390, 20391, 20424, 20425, 20554, 20555, 20557, 20558, 20568, 20776, 20777, 20779, 20780, 20781, 20782, 20783, 20809, 20811, 20813, 20825, 20850, 20851, 20852, 20853, 20876, 20877, 20878, 20879, 20893, 20894, 20895, 20896, 20897, 20930, 20931, 20984, 20985, 20987, 21204, 21206, 21230, 21232, 21234, 21236, 21239, 21506, 21507, 21508, 21509, 21532, 21768, 21770, 21780, 21781, 21782, 21790, 21811, 21817, 21818, 21820, 21821, 21822, 21824, 21825, 21833, 21836, 21952, 21953, 21954, 21955, 21996, 21997, 21998, 21999, 22000, 22001, 22002, 22038, 22039, 22042, 22067, 22068, 22139, 22140, 22141, 22143, 22147, 22184, 22186, 22187, 22246, 22270, 22271, 22296, 22300, 22301, 22396, 22399, 22447, 22458, 22466, 22467, 22627, 22636, 22638, 22639, 22640, 22645, 22646, 22647, 22648, 22657, 22721, 22722, 22723, 22733, 22734, 22735, 22736, 22738, 22780, 22784, 22817, 22819, 22981, 22982, 22983, 22984, 22985, 23075, 23078, 23079, 23108, 23109, 23110, 23132, 23133, 23134, 23135, 23166, 23192, 23393, 23395, 23396, 23397, 23398, 23470, 23471, 23472, 23473, 23478, 23479, 23480, 23482, 23773, 23774, 23961, 23962, 24032, 24371, 24510, 24534, 24621, 24622, 24624, 24657, 24658, 24659, 24660, 24687, 24922, 24923, 24924, 25095, 25096, 25097, 25099, 25101, 25102, 25103, 25126, 25127, 25128, 25129, 25130, 25131, 25142, 25143, 25144, 25145, 25146, 25147, 25148, 25170, 25228, 25229, 25231, 25233, 25319, 25321, 25322, 25403, 25404, 25405, 25406, 25445, 25447, 25448, 25449, 25471, 25498, 25499, 25500, 25501, 25502, 25542, 25543, 25553, 25854, 25855, 25856, 25857, 25858, 25888, 25994, 26034, 26281, 26282, 26283, 26284, 26285, 26317, 26318, 26319, 26321, 26322, 26343, 26346, 26348, 26365, 26366, 26367, 26381, 26382, 26383, 26461, 26475, 26476, 26592, 26593, 26594, 26595, 26603, 26604, 26605, 26606, 26607, 26617, 26618, 26620, 26622, 26623, 26684, 26685, 26810, 26813, 26998, 27001, 27002, 27016, 27020, 27039, 27079, 27080, 27081, 27082, 27083, 27090, 27114, 27115, 27116, 27262, 27263, 27264, 27265, 27266, 27348, 27366, 27367, 27368, 27369, 27370, 27372, 27455, 27467, 27468, 27469, 27470, 27523, 27524, 27527, 27536, 27537, 27538, 27729, 27730, 27832, 27833, 27835, 27838, 27840, 27873, 27899, 27906, 27907, 27979, 27985, 27986, 27990, 28058, 28061, 28248, 28328, 28329, 28505, 28507, 28542, 28544, 28545, 28546, 28547, 28792, 28794, 28796, 28805, 28806, 28808, 28809, 28879, 28880, 28882, 28932, 28935, 29083, 29084, 29086, 29087, 29183, 29184, 29185, 29186, 29201, 29389, 29489, 29491, 29534, 29546, 29623, 29624, 29625, 29818, 29819, 29821, 29875, 29877, 29878, 29892, 29893, 29894, 29923, 29924, 29940, 29953, 29954, 29970, 30017, 30026, 30028, 30030, 30124, 30126, 30127, 30166, 30169, 30170, 30171, 30172, 30190, 30254, 30255, 30256, 30288, 30291, 30499, 30501, 30505, 30673, 30726, 30727, 30728, 30729, 30731, 30732, 30743, 30745, 30886, 30888, 30889, 30890, 30926, 30934, 31057, 31059, 31139, 31164, 31165, 31166, 31294, 31296, 31410, 31536, 31537, 31548, 31581, 31582, 31583, 31584, 31585, 31595, 31596, 31597, 31598, 31599, 31600, 31638, 31659, 31660, 31661, 31693, 31694, 31696, 31697, 31717, 31718, 31720, 31738, 31741, 32089, 32090, 32091, 32092, 32093, 32124, 32125, 32126, 32127, 32184, 32186, 32187, 32219, 32224, 32243, 32244, 32245, 32246, 32247, 32248, 32263, 32264, 32266, 32267, 32268, 32331, 32333, 32334, 32335, 32343, 32398, 32400, 32402, 32403, 32418, 32424, 32454, 32455, 32457, 32458, 32479, 32499, 32500, 32501, 32502, 32503, 32505, 32506, 32580, 32581, 32582, 32583, 32648, 32650, 32651, 32653, 32654, 32667, 32669, 32699, 32762, 32763, 32799, 32810, 32813, 32839, 32840, 32842, 32843, 32844, 32877, 32878, 32879, 32902, 32916, 32917, 32920, 32921, 32927, 32928, 32931, 32932, 32933, 32969, 32973, 32974, 33013, 33014, 33099, 33100, 33102, 33241, 33288, 33289, 33290, 33292, 33347, 33356, 33358, 33438, 33439, 33441, 33442, 33443, 33482, 33483, 33484, 33735, 33737, 33739, 33740, 33742, 33776, 33777, 33778, 33779, 33820, 33821, 33822, 33837, 33867, 33869, 33871, 33950, 33952, 33953, 33956, 33969, 33971, 33972, 34080, 34081, 34082, 34083, 34086, 34127, 34201, 34203, 34248, 34253, 34287, 34290, 34291, 34381, 34383, 34384, 34387, 34586, 34588, 34755, 34756, 34757, 34820, 34821, 35011, 35016, 35017, 35059, 35102, 35103, 35252, 35314, 35451, 35454, 35584, 35585, 35586, 35587, 35588, 35589, 35590, 35604, 35698, 35699, 35700, 35701, 35749, 35752, 35753, 35799, 35808, 35809, 35840, 35862, 35865, 35900, 35903, 35938, 36031, 36208, 36212, 36289, 36353, 36354, 36392, 36543, 36544, 36545, 36546, 36547, 36549, 36564, 36574, 36575, 36579, 36714, 36716, 36717, 36718, 36719, 36804, 36814, 36822, 36828, 36997, 36998, 37000, 37137, 37138, 37139, 37140, 37141, 37142, 37231, 37232, 37243, 37299, 37304, 37473, 37474, 37476, 37480, 37482, 37483, 37490, 37491, 37492, 37493, 37494, 37495, 37660, 37750, 37751, 37752, 37862, 37863, 37900, 37901, 37902, 37904, 37914, 37936, 37939, 38011, 38012, 38101, 38102, 38103, 38104, 38105, 38135, 38137, 38138, 38139, 38349, 38364, 38484, 38485, 38504, 38736, 38737, 38738, 38739, 38757, 38758, 38759, 38780, 38807, 38903, 38905, 38921, 38981, 38993, 39023, 39083, 39085, 39086, 39098, 39100, 39165, 39173, 39174, 39249, 39250, 39268, 39284, 39325, 39329, 39334, 39337, 39367, 39368, 39370, 39371, 39448, 39449, 39450, 39451, 39452, 39453, 39582, 39584, 39585, 39586, 39587, 39598, 39599, 39660, 39668, 39823, 39842, 39850, 39851, 39852, 39854, 39855, 39856, 39886, 39887, 39888, 39889, 40103, 40104, 40105, 40147, 40204, 40238, 40315, 40361, 40413, 40414, 40603, 40720, 40726, 40727, 40728, 40735, 40776, 40897, 40898, 40899, 40900, 41147, 41148, 41149, 41150, 41156, 41167, 41219, 41287, 41288, 41289, 41307, 41308, 41591, 41595, 41612, 41613, 41614, 41615, 41627, 41645, 41665, 41670, 41672, 41673, 41676, 41696, 41697, 41698, 41702, 41704, 41705, 41706, 41841, 41845, 41923, 41924, 41926, 42088, 42089, 42138, 42139, 42218, 42219, 42221, 42222, 42252, 42256, 42273, 42274, 42275, 42276, 42277, 42278, 42314, 42337, 42338, 42348, 42349, 42350, 42352, 42353, 42354, 42355, 42356, 42428, 42429, 42469, 42470, 42545, 42546, 42613, 42614, 42615, 42616, 42617, 42638, 42645, 42646, 42648, 42808, 42810, 42817, 42861, 42862, 42863, 42908, 42909, 42910, 42911, 42951, 42953, 42955, 43285, 43410, 43412, 43617, 43666, 43701, 43801, 44031, 44032, 44069, 44070, 44071, 44072, 44073, 44074, 44199, 44200, 44201, 44202, 44277, 44278, 44293, 44294, 44295, 44297, 44313, 44316, 44318, 44382, 44414, 44435, 44436, 44439, 44440, 44484, 44514, 44516, 44517, 44554, 44559, 44567, 44661, 44662, 44663, 44664, 44694, 44696, 44700, 44861, 44955, 44999, 45001, 45002, 45003, 45014, 45127, 45128, 45131, 45133, 45165, 45182, 45193, 45216, 45521, 45568, 45569, 45570, 45572, 45573, 45574, 45594, 45595, 45596, 45597, 45599, 45670, 45680, 45681, 45682, 45696, 45697, 45698, 45812, 45993, 45994, 46003, 46004, 46005, 46107, 46108, 46284, 46357, 46437, 46474, 46475, 46616, 46617, 46618, 46619, 46620, 46690, 46698, 46843, 46844, 46845, 46847, 46853, 46854, 46895, 46898, 46899, 46900, 46947, 46949, 46950, 46953, 46954, 46955, 46987, 46989, 47100, 47102, 47119, 47120, 47123, 47148, 47235, 47236, 47237, 47253, 47254, 47255, 47256, 47257, 47258, 47268, 47270, 47274, 47276, 47399, 47400, 47401, 47403, 47424, 47426, 47442, 47443, 47444, 47458, 47460, 47461, 47462, 47482, 47483, 47501, 47502, 47503, 47504, 47505, 47548, 47549, 47550, 47551, 47552, 47553, 47863, 47925, 47926, 47927, 47929, 47930, 47936, 47946, 47947, 47950, 47953, 47954, 48013, 48043, 48045, 48046, 48047, 48074, 48075, 48076, 48077, 48120, 48121, 48122, 48335, 48337, 48348, 48350, 48423, 48425, 48514, 48515, 48530, 48611, 48614, 48668, 48714, 48721, 48722, 48723, 48846, 48847, 48848, 48849, 48872, 48886, 48887, 48890, 48891, 48892, 48900, 49017, 49019, 49123, 49124, 49125, 49126, 49183, 49184, 49359, 49360, 49361, 49362, 49363, 49364, 49502, 49506, 49684, 49685, 49686, 49687, 49688, 49689, 49732, 49733, 49794, 49795, 49897, 49898, 49899, 49922, 49948, 49949, 49974, 49976, 50098, 50101, 50102, 50103, 50130, 50131, 50220, 50222, 50223, 50238, 50241, 50302, 50469, 50470, 50471, 50472, 50478, 50480, 50487, 50488, 50490, 50543, 50544, 50545, 50634, 50635, 50735, 50767, 50768, 50815, 50836, 50838, 50855, 50857, 50859, 50860, 50881, 50883, 50885, 50912, 50943, 50944, 50946, 50947, 51047, 51048, 51049, 51050, 51052, 51079, 51081, 51082, 51124, 51125, 51126, 51127, 51128, 51183, 51188, 51189, 51367, 51369, 51370, 51371, 51372, 51373, 51374, 51379, 51380, 51381, 51481, 51482, 51598, 51606, 51607, 51608, 51622, 51623, 51624, 51625, 51682, 51683, 51684, 51693, 51694, 51695, 51696, 51709, 51710, 51885, 51888, 51889, 51890, 51891, 51897, 51949, 51951, 51992, 51993, 51994, 51996, 51997, 52000, 52002, 52003, 52005, 52045, 52046, 52047, 52048, 52049, 52050, 52101, 52102, 52104, 52133, 52240, 52241, 52242, 52243, 52244, 52246, 52320, 52322, 52335, 52363, 52365, 52477, 52478, 52480, 52481, 52485, 52486, 52487, 52488, 52514, 52515, 52516, 52517, 52518, 52519, 52520, 52576, 52578, 52579, 52594, 52595, 52596, 52746, 52748, 52749, 52750, 52778, 52854, 52879, 52880, 52883, 52975, 52976, 52977, 52978, 52979, 52980, 52997, 52998, 53000, 53001, 53007, 53008, 53011, 53026, 53027, 53028, 53029, 53062, 53063, 53064, 53065, 53067, 53103, 53104, 53106, 53107, 53140, 53141, 53142, 53265, 53267, 53268, 53300, 53301, 53303, 53323, 53327, 53614, 53641, 53646, 53694, 53695, 53797, 53805, 53807, 53808, 53887, 54033, 54226, 54227, 54228, 54229, 54247, 54249, 54280, 54282, 54285, 54319, 54334, 54385, 54386, 54390, 54483, 54484, 54485, 54486, 54536, 54538, 54540, 54577, 54578, 54579, 54580, 54582, 54583, 54668, 54673, 54712, 54715, 54723, 54724, 54725, 54726, 55212, 55213, 55256, 55257, 55387, 55389, 55541, 55542, 55543, 55544, 55545, 55546, 55588, 55589, 55590, 55600, 55601, 55663, 55665, 55703, 55734, 55735, 55749, 55890, 55891, 55892, 55947, 55986, 55988, 55989, 55998, 55999, 56000, 56001, 56002, 56003, 56058, 56059, 56096, 56097, 56106, 56107, 56108, 56145, 56148, 56149, 56152, 56154, 56157, 56159, 56161, 56162, 56186, 56188, 56189, 56190, 56191, 56192, 56225, 56268, 56269, 56271, 56272, 56273, 56274, 56410, 56456, 56465, 56482, 56486, 56570, 56571, 56573, 56574, 56609, 56610, 56611, 56612, 56613, 56692, 56693, 56694, 56727, 56728, 56936, 57012, 57013, 57014, 57015, 57017, 57041, 57042, 57044, 57144, 57145, 57245, 57246, 57248, 57259, 57260, 57261, 57262, 57346, 57356, 57366, 57367, 57368, 57422, 57441, 57493, 57494, 57495, 57496, 57497, 57632, 57635, 57636, 57820, 57821, 57927, 57928, 57929, 57984, 57986, 58107, 58109, 58110, 58111, 58112, 58128, 58129, 58130, 58131, 58132, 58193, 58194, 58197, 58204, 58230, 58231, 58233, 58234, 58390, 58428, 58537, 58538, 58540, 58541, 58579, 58580, 58581, 58602, 58669, 58671, 58724, 58728, 58753, 58755, 58756, 58757, 58758, 58759, 58760, 58761, 58762, 58763, 58817, 58818, 58819, 58823, 58836, 58838, 58844, 58883, 58886, 58889, 58890, 58892, 58894, 58895, 58896, 58897, 59104, 59106, 59109, 59160, 59161, 59274, 59347, 59348, 59349, 59369, 59370, 59371, 59373, 59377, 59496, 59497, 59499, 59500, 59501, 59585, 59586, 59587, 59588, 59663, 59678, 59714, 59715, 59716, 59718, 59719, 59721, 59722, 59723, 59725, 59726, 59903, 59904, 59905, 59909, 59910, 59919, 59920, 59921, 59922, 59923, 60158, 60161, 60162, 60163, 60164, 60166, 40, 7771, 9952, 10903, 12472, 13499, 14203, 15560, 16513, 19101, 25233, 27039, 29183, 29534, 32503, 32928, 33013, 34384, 36564, 40603, 42862, 44694, 46107, 48013, 49124, 50241, 50488, 51050, 52242, 53103, 54726, 55999, 58538, 59905]

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'COUNT', 0)
----
2319

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'LIN', '0')
----
2319

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'PERM', '0')
----
4349

query I
PRAGMA backward_lineage("SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier, (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue0 WHERE s_suppkey = supplier_no AND total_revenue = (SELECT max(total_revenue) FROM (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= CAST('1996-01-01' AS date) AND l_shipdate < CAST('1996-04-01' AS date) GROUP BY supplier_no) revenue1) ORDER BY s_suppkey", 'PROV', '0')
----
2319
