# name: test/sql/lineage/perm/hash_join.test
# description: Test Hash Joins with PERM mode
# group: [perm]

statement ok
CREATE TABLE t1(i INTEGER, j INTEGER);

statement ok
INSERT INTO t1 VALUES (3, 1), (NULL, 2), (2, 3), (3, 4), (3, 8), (3, 7);

statement ok
CREATE TABLE t2(i INTEGER, k VARCHAR(10));

statement ok
INSERT INTO t2 VALUES (3, 'A'), (2, 'B'), (3, 'C'), (1, 'D'), (3, 'A');

statement ok
PRAGMA trace_lineage = "ON";

query II
select t1.j, t2.k from t1 inner join t2 on (t1.i = t2.i);
----
1	A
3	B
4	A
8	A
7	A
1	C
4	C
8	C
7	C
1	A
4	A
8	A
7	A

statement ok
PRAGMA trace_lineage = "OFF";

query III
PRAGMA lineage_query('select t1.j, t2.k from t1 inner join t2 on (t1.i = t2.i);', '0', 'PERM', 0)
----
0	4	0

query III
PRAGMA lineage_query('select t1.j, t2.k from t1 inner join t2 on (t1.i = t2.i);', '3', 'PERM', 0)
----
4	4	3

query III
PRAGMA lineage_query('select t1.j, t2.k from t1 inner join t2 on (t1.i = t2.i);', '4', 'PERM', 0)
----
5	4	4

query III
PRAGMA lineage_query('select t1.j, t2.k from t1 inner join t2 on (t1.i = t2.i);', '9', 'PERM', 0)
----
0	0	9

query III
PRAGMA lineage_query('select t1.j, t2.k from t1 inner join t2 on (t1.i = t2.i);', '0,1,2,3,4,5,6,7,8,9,10,11,12', 'PERM', 0)
----
0	4	0
2	1	1
3	4	2
4	4	3
5	4	4
0	2	5
3	2	6
4	2	7
5	2	8
0	0	9
3	0	10
4	0	11
5	0	12
