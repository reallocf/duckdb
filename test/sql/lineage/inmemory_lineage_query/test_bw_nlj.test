# name: test/sql/lineage/inmemory_lineage_query/test_bw_nlj.test
# description: Test Nested Loop Join
# group: [inmemory_lineage_query]

statement ok
CREATE TABLE t1(i INTEGER);

statement ok
CREATE TABLE t2(i INTEGER);

statement ok
INSERT INTO t1 SELECT i FROM range(0,1024) tbl(i);
INSERT INTO t1 SELECT i FROM range(0,1024) tbl(i);
INSERT INTO t2 VALUES (1022);
INSERT INTO t2 SELECT i FROM range(2048,4096) tbl(i);
INSERT INTO t2 VALUES (1022);

statement ok
PRAGMA trace_lineage = "ON"

# standalone limit
query IIII
select t1.rowid, t2.rowid, t1.i, t2.i from t1, t2 where  t1.i > t2.i and t1.i <> t2.i
----
1023	0	1023	1022
2047	0	1023	1022
1023	2049	1023	1022
2047	2049	1023	1022

statement ok
PRAGMA trace_lineage = "OFF";

query I
PRAGMA lineage_query('select t1.rowid, t2.rowid, t1.i, t2.i from t1, t2 where  t1.i > t2.i and t1.i <> t2.i', 0, 'LIN', 0)
----
[0, 1023]

query I
PRAGMA lineage_query('select t1.rowid, t2.rowid, t1.i, t2.i from t1, t2 where  t1.i > t2.i and t1.i <> t2.i', 1, 'LIN', 0)
----
[0, 2047]

query I
PRAGMA lineage_query('select t1.rowid, t2.rowid, t1.i, t2.i from t1, t2 where  t1.i > t2.i and t1.i <> t2.i', 2, 'LIN', 0)
----
[2049, 1023]

query I
PRAGMA lineage_query('select t1.rowid, t2.rowid, t1.i, t2.i from t1, t2 where  t1.i > t2.i and t1.i <> t2.i', 3, 'LIN', 0)
----
[2049, 2047]