# name: test/sql/lineage/inmemory_tpch_queries/test_tpch_06.test
# description: Test TPC-H Query 6 in-memory
# group: [inmemory_tpch_queries]

require tpch

statement ok
CALL dbgen(sf=0.01);

statement ok
PRAGMA trace_lineage = "ON";

statement ok
SELECT sum(l_extendedprice * l_discount) AS revenue FROM lineitem WHERE l_shipdate >= CAST('1994-01-01' AS date) AND l_shipdate < CAST('1995-01-01' AS date) AND l_discount BETWEEN 0.05 AND 0.07 AND l_quantity < 24

statement ok
PRAGMA trace_lineage = "OFF";

query I
PRAGMA lineage_query("SELECT sum(l_extendedprice * l_discount) AS revenue FROM lineitem WHERE l_shipdate >= CAST('1994-01-01' AS date) AND l_shipdate < CAST('1995-01-01' AS date) AND l_discount BETWEEN 0.05 AND 0.07 AND l_quantity < 24", 0, 'LIN', 0)
----
[55, 79, 81, 85, 99, 252, 289, 303, 305, 306, 331, 332, 335, 346, 349, 546, 651, 821, 892, 893, 914, 934, 945, 981, 1028, 1045, 1046, 1132, 1134, 1187, 1189, 1254, 1290, 1420, 1699, 1745, 1760, 1818, 1835, 1838, 1848, 1904, 1947, 1982, 1986, 2047, 2189, 2214, 2215, 2216, 2341, 2434, 2437, 2591, 2743, 2753, 2757, 2770, 2774, 2812, 2822, 2835, 2888, 2949, 2984, 3098, 3108, 3164, 3171, 3195, 3303, 3322, 3432, 3434, 3491, 3577, 3609, 3620, 3716, 3717, 3907, 3966, 4039, 4089, 4124, 4170, 4234, 4453, 4483, 4484, 4491, 4607, 4690, 4708, 4744, 4801, 4884, 4885, 4886, 4914, 4915, 4966, 5098, 5307, 5314, 5316, 5342, 5360, 5523, 5533, 5732, 5734, 5753, 5771, 5919, 5990, 6015, 6128, 6153, 6174, 6176, 6207, 6471, 6472, 6490, 6667, 6675, 6677, 6733, 6797, 6803, 6804, 6891, 6894, 6941, 7027, 7078, 7242, 7305, 7415, 7420, 7449, 7454, 7470, 7472, 7497, 7721, 7726, 7746, 7793, 7881, 7928, 7947, 8080, 8153, 8232, 8251, 8259, 8260, 8303, 8392, 8396, 8622, 8626, 8636, 8659, 8722, 8730, 8853, 8922, 8929, 8935, 8981, 8984, 8988, 9002, 9055, 9094, 9155, 9157, 9173, 9219, 9472, 9571, 9591, 9594, 9601, 9618, 9688, 9850, 9887, 9922, 10030, 10033, 10079, 10097, 10125, 10140, 10178, 10181, 10207, 10227, 10231, 10465, 10470, 10519, 10603, 10604, 10606, 10640, 10642, 10792, 10819, 10848, 10850, 10851, 10871, 10932, 10963, 11027, 11146, 11267, 11300, 11371, 11373, 11378, 11487, 11549, 11675, 11680, 11875, 11944, 11959, 12204, 12239, 12289, 12383, 12385, 12414, 12466, 12516, 12530, 12599, 12600, 12623, 12648, 12654, 12716, 12744, 12909, 12911, 12917, 12918, 12950, 13029, 13051, 13140, 13142, 13216, 13337, 13392, 13439, 13448, 13480, 13511, 13515, 13567, 13649, 13667, 13670, 13673, 13802, 13999, 14000, 14145, 14162, 14277, 14334, 14382, 14457, 14512, 14517, 14587, 14591, 14666, 14809, 14965, 15060, 15075, 15166, 15189, 15216, 15393, 15408, 15478, 15479, 15480, 15590, 15772, 15877, 16210, 16212, 16233, 16234, 16242, 16243, 16455, 16578, 16686, 16688, 16762, 16764, 16841, 16851, 16876, 16879, 16933, 16949, 17003, 17005, 17009, 17011, 17158, 17177, 17188, 17227, 17292, 17311, 17337, 17636, 17642, 17738, 17767, 18101, 18125, 18153, 18220, 18272, 18300, 18322, 18386, 18447, 18467, 18569, 18592, 18615, 18712, 18736, 18740, 18769, 18782, 18784, 18823, 18825, 18917, 18930, 19031, 19045, 19058, 19067, 19080, 19205, 19228, 19234, 19237, 19395, 19447, 19456, 19459, 19512, 19598, 19783, 19951, 20054, 20057, 20135, 20184, 20190, 20199, 20207, 20244, 20261, 20276, 20277, 20291, 20298, 20372, 20448, 20449, 20477, 20513, 20518, 20579, 20583, 20589, 20833, 20836, 20915, 20916, 20919, 20920, 20922, 20938, 20939, 20940, 21138, 21184, 21185, 21186, 21243, 21244, 21362, 21455, 21562, 21646, 21712, 21715, 21720, 21732, 21740, 21867, 21882, 21936, 22048, 22079, 22172, 22221, 22236, 22258, 22324, 22330, 22339, 22341, 22412, 22416, 22461, 22514, 22612, 22671, 22742, 22956, 22959, 22999, 23001, 23048, 23069, 23121, 23221, 23240, 23247, 23270, 23273, 23274, 23365, 23371, 23462, 23491, 23586, 23633, 23648, 23649, 23651, 23838, 23920, 23971, 24012, 24015, 24017, 24040, 24155, 24285, 24448, 24449, 24471, 24474, 24479, 24485, 24538, 24591, 24645, 24650, 24656, 24711, 24794, 24835, 24838, 24853, 24952, 25028, 25029, 25109, 25223, 25235, 25250, 25465, 25487, 25534, 25596, 25614, 25615, 25640, 25647, 25672, 25723, 25734, 25764, 25877, 25973, 26084, 26085, 26087, 26145, 26294, 26337, 26445, 26525, 26528, 26536, 26602, 26630, 26727, 26738, 26792, 26793, 26829, 26844, 26846, 26848, 26895, 27003, 27004, 27005, 27043, 27103, 27124, 27177, 27178, 27183, 27207, 27330, 27530, 27619, 27677, 27678, 27679, 27746, 27749, 27799, 27837, 27856, 28005, 28104, 28105, 28204, 28207, 28295, 28318, 28355, 28374, 28385, 28397, 28399, 28400, 28514, 28518, 28664, 28665, 28683, 28878, 28891, 28997, 29131, 29162, 29198, 29235, 29236, 29245, 29317, 29360, 29435, 29590, 29610, 29619, 29654, 29803, 29871, 29872, 29899, 30014, 30015, 30016, 30031, 30090, 30139, 30246, 30271, 30299, 30368, 30431, 30495, 30557, 30559, 30562, 30630, 30633, 30975, 30976, 30977, 30987, 31005, 31006, 31035, 31036, 31128, 31293, 31317, 31320, 31348, 31350, 31370, 31530, 31532, 31555, 31614, 31620, 31681, 31682, 31724, 31891, 31917, 32242, 32270, 32324, 32341, 32407, 32491, 32509, 32643, 32726, 32750, 32759, 32806, 32883, 32888, 32891, 32893, 32908, 32910, 32938, 32940, 32950, 32953, 33001, 33004, 33071, 33213, 33218, 33307, 33311, 33312, 33331, 33343, 33397, 33399, 33430, 33472, 33473, 33474, 33559, 33563, 33689, 33903, 33904, 34094, 34103, 34104, 34188, 34190, 34204, 34305, 34377, 34399, 34480, 34573, 34579, 34580, 34612, 34615, 34625, 34674, 34686, 34687, 34760, 34766, 34981, 35066, 35071, 35159, 35293, 35303, 35305, 35385, 35431, 35514, 35543, 35598, 35644, 35844, 35896, 35984, 36021, 36086, 36099, 36102, 36234, 36266, 36395, 36426, 36487, 36500, 36501, 36540, 36573, 36722, 36920, 36994, 37047, 37055, 37067, 37114, 37242, 37259, 37385, 37560, 37594, 37687, 37785, 37836, 37838, 37881, 37883, 37916, 37919, 38071, 38073, 38107, 38154, 38160, 38166, 38244, 38286, 38361, 38362, 38419, 38469, 38568, 38572, 38573, 38609, 38639, 38652, 38656, 38677, 38735, 38743, 38835, 38846, 38932, 38937, 38954, 38956, 38957, 38984, 39143, 39178, 39179, 39203, 39232, 39261, 39318, 39462, 39572, 39611, 39614, 39615, 39648, 39675, 39702, 39714, 39783, 39989, 39992, 40010, 40035, 40098, 40130, 40134, 40174, 40248, 40287, 40288, 40297, 40327, 40366, 40384, 40389, 40393, 40459, 40491, 40533, 40891, 40931, 40948, 40968, 41181, 41193, 41274, 41275, 41280, 41281, 41433, 41435, 41443, 41465, 41466, 41482, 41514, 41515, 41518, 41579, 41684, 41721, 41724, 41725, 41765, 41826, 41829, 41879, 41889, 41997, 42006, 42049, 42070, 42144, 42302, 42412, 42439, 42484, 42520, 42522, 42571, 42576, 42591, 42592, 42594, 42596, 42598, 42599, 42601, 42634, 42635, 42684, 42792, 42844, 42960, 43103, 43259, 43260, 43353, 43435, 43450, 43461, 43510, 43578, 43629, 43941, 43984, 44111, 44135, 44195, 44258, 44389, 44410, 44462, 44596, 44712, 44728, 44802, 44974, 45020, 45123, 45126, 45143, 45298, 45302, 45384, 45455, 45586, 45588, 45605, 45739, 45872, 46135, 46181, 46246, 46375, 46536, 46537, 46538, 46633, 46646, 46686, 46689, 46724, 46797, 46798, 46804, 46805, 46983, 46985, 47042, 47117, 47150, 47174, 47181, 47277, 47303, 47328, 47355, 47487, 47491, 47711, 47831, 47909, 48020, 48041, 48082, 48140, 48169, 48180, 48260, 48263, 48344, 48374, 48377, 48378, 48410, 48430, 48433, 48525, 48526, 48535, 48537, 48540, 48562, 48581, 48605, 48609, 48622, 48671, 48674, 48789, 48937, 48982, 48986, 49033, 49052, 49055, 49098, 49115, 49129, 49157, 49228, 49265, 49303, 49314, 49334, 49397, 49439, 49442, 49443, 49471, 49623, 49699, 49704, 49728, 49849, 49942, 50004, 50029, 50097, 50181, 50185, 50194, 50198, 50246, 50392, 50445, 50446, 50448, 50482, 50504, 50541, 50552, 50557, 50572, 50589, 50640, 50720, 50888, 50893, 50917, 50938, 50997, 51025, 51045, 51107, 51237, 51258, 51331, 51386, 51387, 51434, 51457, 51544, 51701, 51760, 51778, 51780, 52035, 52094, 52113, 52266, 52296, 52297, 52298, 52394, 52413, 52426, 52561, 52563, 52592, 52634, 52636, 52768, 52797, 52802, 53086, 53295, 53332, 53333, 53350, 53355, 53392, 53403, 53428, 53451, 53484, 53508, 53566, 53724, 53953, 53970, 54066, 54067, 54069, 54130, 54196, 54203, 54407, 54542, 54543, 54617, 54630, 54641, 54659, 54693, 54834, 54835, 54836, 54924, 54925, 54930, 55026, 55133, 55202, 55224, 55272, 55302, 55422, 55429, 55466, 55470, 55474, 55476, 55503, 55519, 55538, 55553, 55556, 55562, 55619, 55624, 55654, 55725, 55872, 55895, 55897, 55899, 55994, 56005, 56009, 56046, 56049, 56053, 56064, 56181, 56184, 56194, 56342, 56495, 56641, 56643, 56646, 56711, 56713, 56730, 56732, 56828, 56967, 56968, 56987, 57050, 57098, 57101, 57141, 57282, 57288, 57314, 57377, 57435, 57556, 57584, 57640, 57761, 57766, 57767, 57768, 57835, 57917, 57919, 57956, 57957, 57967, 57976, 58123, 58250, 58252, 58334, 58381, 58423, 58449, 58460, 58461, 58556, 58766, 58813, 58814, 58832, 58905, 58925, 59030, 59031, 59086, 59168, 59226, 59227, 59380, 59405, 59406, 59407, 59712, 59844, 59916, 59953, 59954, 60007, 60010, 60054, 60133, 60167]

query I
PRAGMA backward_lineage("SELECT sum(l_extendedprice * l_discount) AS revenue FROM lineitem WHERE l_shipdate >= CAST('1994-01-01' AS date) AND l_shipdate < CAST('1995-01-01' AS date) AND l_discount BETWEEN 0.05 AND 0.07 AND l_quantity < 24", 'COUNT', '0')
----
1191

query I
PRAGMA backward_lineage("SELECT sum(l_extendedprice * l_discount) AS revenue FROM lineitem WHERE l_shipdate >= CAST('1994-01-01' AS date) AND l_shipdate < CAST('1995-01-01' AS date) AND l_discount BETWEEN 0.05 AND 0.07 AND l_quantity < 24", 'LIN', '0')
----
1191

query I
PRAGMA backward_lineage("SELECT sum(l_extendedprice * l_discount) AS revenue FROM lineitem WHERE l_shipdate >= CAST('1994-01-01' AS date) AND l_shipdate < CAST('1995-01-01' AS date) AND l_discount BETWEEN 0.05 AND 0.07 AND l_quantity < 24", 'PERM', '0')
----
1191

query I
PRAGMA backward_lineage("SELECT sum(l_extendedprice * l_discount) AS revenue FROM lineitem WHERE l_shipdate >= CAST('1994-01-01' AS date) AND l_shipdate < CAST('1995-01-01' AS date) AND l_discount BETWEEN 0.05 AND 0.07 AND l_quantity < 24", 'PROV', '0')
----
1191
