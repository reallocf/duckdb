# name: test/sql/lineage/inmemory_lineage_query/test_bw_groupby_perfect_hash_aggregate_lineage.test
# description: Test Group By lineage -- perfect hash aggregate
# group: [inmemory_lineage_query]

statement ok
PRAGMA trace_lineage = "OFF";

statement ok
CREATE TABLE t1(i INTEGER, j INTEGER);
CREATE TABLE t2(i INTEGER);

statement ok
INSERT INTO t1 VALUES (1, 2),  (5, 2), (1, 4), (2, 1), (1, 3),(2, 2), (4, 1), (5, 1);
INSERT INTO t2 SELECT i FROM range(0,1030) tbl(i)


statement ok
PRAGMA trace_lineage = "ON";

# standalone limit
statement ok
select t1.i, avg(t1.j) from t1 GROUP BY t1.i

statement ok
SELECT i FROM t2 GROUP BY i

statement ok
PRAGMA trace_lineage = "OFF";

query I
PRAGMA backward_lineage('select t1.i, avg(t1.j) from t1 GROUP BY t1.i', '3')
----
[1, 7]

query I
PRAGMA backward_lineage('select t1.i, avg(t1.j) from t1 GROUP BY t1.i', '0')
----
[0, 2, 4]

query I
PRAGMA backward_lineage('SELECT i FROM t2 GROUP BY i', '0')
----
[0]

query I
PRAGMA backward_lineage('SELECT i FROM t2 GROUP BY i', '129')
----
[129]