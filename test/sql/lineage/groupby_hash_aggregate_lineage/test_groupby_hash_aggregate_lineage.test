# name: test/sql/lineage/groupby_lineage/test_groupby_hash_aggregate_lineage.test
# description: Test Group By linage -- hash aggregate
# group: [groupby_hash_aggregate_lineage]

statement ok
PRAGMA trace_lineage = "OFF";

statement ok
CREATE TABLE t1(i VARCHAR(10), j INTEGER);

statement ok
INSERT INTO t1 VALUES ('Haneen', 2),  ('Omar', 2), ('Haneen', 4), ('Mohammed', 1), ('Omar', 1), ('Haneen', 3), ('Mohammed', 2), ('Omar', 1)

statement ok
PRAGMA trace_lineage = "ON";

# standalone limit
query IIII
select t1.i, avg(t1.j), sum(t1.j + 1), max(t1.i) from t1 GROUP BY t1.i
----
Haneen	3.000000	12	Haneen
Omar	1.333333	7	Omar
Mohammed	1.500000	5	Mohammed

statement ok
PRAGMA trace_lineage = "OFF";

query II
SELECT * FROM queries_list;
----
1	select t1.i, avg(t1.j), sum(t1.j + 1), max(t1.i) from t1 GROUP BY t1.i
2	PRAGMA trace_lineage = "OFF";

query III
select sink.rowid, sink.in_index, scan.out_index from LINEAGE_1_HASH_GROUP_BY_2_1 as scan, LINEAGE_1_HASH_GROUP_BY_2_0 as sink where scan.in_index=sink.out_index;
----
0	0	0
1	1	1
2	2	0
3	3	2
4	4	1
5	5	0
6	6	2
7	7	1

query IIII
select in_index, agg_0, agg_1, agg_2 from LINEAGE_1_HASH_GROUP_BY_2_AGG;
----
0	2	3	Haneen
1	2	3	Omar
2	4	5	Haneen
3	1	2	Mohammed
4	1	2	Omar
5	3	4	Haneen
6	2	3	Mohammed
7	1	2	Omar