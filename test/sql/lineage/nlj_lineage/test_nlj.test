# name: test/sql/lineage/nlj_lineage/test_nlj.test
# description: Test Nested Loop Join
# group: [nlj_lineage]

statement ok
CREATE TABLE t1(i INTEGER, j INTEGER);

statement ok
CREATE TABLE t2(i INTEGER);

statement ok
INSERT INTO t1 SELECT i+1, i FROM range(0,10) tbl(i);
INSERT INTO t2 VALUES (1), (1000), (10)

statement ok
PRAGMA trace_lineage = "ON"

# standalone limit
query III
select t1.i, t1.j, t2.i from t1, t2 where  t1.i > t2.i and t1.i <> t2.i
----
2	1	1
3	2	1
4	3	1
5	4	1
6	5	1
7	6	1
8	7	1
9	8	1
10	9	1

query II
select query_id, query from queries_list;
----
11	select t1.i, t1.j, t2.i from t1, t2 where  t1.i > t2.i and t1.i <> t2.i
13	select query_id, query from queries_list;


statement ok
PRAGMA trace_lineage = "OFF";

query II
select * from NESTED_LOOP_JOIN_11_0_SINK;
----
0	0

query IIIII
select lhs_value, rhs_value, rhs_chunk_id, out_index, out_chunk_id from NESTED_LOOP_JOIN_11_0;
----
1	0	0	0	0
2	0	0	1	0
3	0	0	2	0
4	0	0	3	0
5	0	0	4	0
6	0	0	5	0
7	0	0	6	0
8	0	0	7	0
9	0	0	8	0