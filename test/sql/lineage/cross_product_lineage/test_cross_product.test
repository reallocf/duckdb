# name: test/sql/lineage/cross_product_lineage/test_cross_product.test
# description: Test Cross Product Lineage
# group: [cross_product_lineage]

statement ok
CREATE TABLE t1(i INTEGER);

statement ok
CREATE TABLE t2(i INTEGER);

statement ok
INSERT INTO t1 SELECT i FROM range(0,3072) tbl(i);
INSERT INTO t2 SELECT i FROM range(0,3072) tbl(i);

statement ok
PRAGMA trace_lineage = "ON"

# standalone limit
query IIII
select t1.rowid, t2.rowid, t1.i, t2.i from t1, t2 where (t1.i<2 or t1.i=1024 or t1.i>3069) and (t2.i<3 or t2.i=1025 or t2.i>3070)
----
0	0	0	0
1	0	1	0
0	1	0	1
1	1	1	1
0	2	0	2
1	2	1	2
0	1025	0	1025
1	1025	1	1025
0	3071	0	3071
1	3071	1	3071
1024	0	1024	0
1024	1	1024	1
1024	2	1024	2
1024	1025	1024	1025
1024	3071	1024	3071
3070	0	3070	0
3071	0	3071	0
3070	1	3070	1
3071	1	3071	1
3070	2	3070	2
3071	2	3071	2
3070	1025	3070	1025
3071	1025	3071	1025
3070	3071	3070	3071
3071	3071	3071	3071

statement ok
PRAGMA trace_lineage = "OFF";

query I
PRAGMA show_tables;
----
LINEAGE_1_CROSS_PRODUCT_4_0
LINEAGE_1_CROSS_PRODUCT_4_1
LINEAGE_1_FILTER_1_0
LINEAGE_1_FILTER_3_0
LINEAGE_1_SEQ_SCAN_0_0
LINEAGE_1_SEQ_SCAN_2_0
queries_list
t1
t2

query II
SELECT * FROM LINEAGE_1_FILTER_1_0
----
0	0
1	1
1024	2
3070	3
3071	4

query II
SELECT * FROM LINEAGE_1_FILTER_3_0
----
0	0
1	1
2	2
1025	3
3071	4

query III
SELECT LINEAGE_1_FILTER_1_0.in_index, LINEAGE_1_FILTER_3_0.in_index, LINEAGE_1_CROSS_PRODUCT_4_1.out_index FROM LINEAGE_1_CROSS_PRODUCT_4_1, LINEAGE_1_FILTER_1_0, LINEAGE_1_FILTER_3_0
where LINEAGE_1_FILTER_1_0.out_index=LINEAGE_1_CROSS_PRODUCT_4_1.lhs_index and LINEAGE_1_FILTER_3_0.out_index=LINEAGE_1_CROSS_PRODUCT_4_1.rhs_index
----
0	0	0
1	0	1
0	1	2
1	1	3
0	2	4
1	2	5
0	1025	6
1	1025	7
0	3071	8
1	3071	9
1024	0	10
1024	1	11
1024	2	12
1024	1025	13
1024	3071	14
3070	0	15
3071	0	16
3070	1	17
3071	1	18
3070	2	19
3071	2	20
3070	1025	21
3071	1025	22
3070	3071	23
3071	3071	24